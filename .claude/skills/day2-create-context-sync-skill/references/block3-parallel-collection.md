# Block 3: 수집 실행 & 검증

> **Phase A 시작 시 반드시 아래 형태로 출력한다:**
> ```
> 📖 공식 문서: https://docs.claude.com/en/docs/claude-code/sub-agents
> ```

## EXPLAIN

### Day 1 복습: Subagent와 Agent Teams

Day 1 Block 3-4에서 배운 **Subagent**를 기억하시나요?

- **Subagent** = 부하 직원. Claude가 다른 Claude를 불러서 독립된 공간에서 일을 시키고, 결과만 받는 것
- **Agent Teams** (Block 3-5) = 프로젝트 팀. 여러 Claude가 서로 소통하면서 협업하는 것

오늘은 이 Subagent를 **실전에 적용**합니다.

### "병렬 수집"이란?

여러 도구에서 **동시에** 정보를 가져오는 것입니다.

**카페로 비유해볼게요.**

점심시간, 손님이 한꺼번에 몰린 카페를 상상해보세요.

**직원 1명인 카페 (순차 수집)**
- 한 명이 주문 받고 → 커피 만들고 → 디저트 준비하고 → 서빙
- 손님 3팀 처리에 30분

**직원 3명인 카페 (병렬 수집)**
- 한 명은 주문+결제, 한 명은 커피, 한 명은 디저트
- 각자 맡은 일만 집중 → 손님 3팀 처리에 10분

Claude도 마찬가지입니다. "싱크해줘"라고 말하면:

- **직원 A (Slack 담당)**: 채널 메시지 수집 중...
- **직원 B (Gmail 담당)**: 이메일 수집 중...
- **직원 C (Calendar 담당)**: 일정 수집 중...

3명이 **동시에** 일하고, 다 끝나면 **매니저(메인 Claude)**가 결과를 모아 하나의 문서로 정리합니다.

```
❌ 순차 수집 (직원 1명): 90초
  Slack(30초) → Gmail(30초) → Calendar(30초)

✅ 병렬 수집 (직원 3명): 30초
  Slack(30초)    ─┐
  Gmail(30초)     ├── 동시에!
  Calendar(30초)  ─┘
```

### 어떻게 동시에 하나?

Claude는 **Subagent(부하 직원)**를 여러 명 동시에 부릅니다. Day 1에서 배운 그 subagent입니다.

핵심은 3가지:
- 각 subagent는 **하나의 도구만 담당**합니다 (Slack 담당, Gmail 담당...)
- 서로의 결과를 기다리지 않고 **독립적으로** 수집합니다
- 모든 subagent가 끝나면, 메인 Claude가 **결과를 모아서 통합**합니다

<details>
<summary>(참고) 기술적 구조가 궁금하다면</summary>

Claude는 **Task 도구**로 subagent를 여러 개 동시에 호출합니다:

```
┌─ 메인 Claude ─────────────────────────────────────┐
│                                                   │
│  "싱크 실행해줘" 요청 받음                          │
│                                                   │
│  ┌─ Subagent 1 ─┐  ┌─ Subagent 2 ─┐  ┌─ Subagent 3 ─┐
│  │ Slack 수집    │  │ Gmail 수집    │  │ Calendar 수집  │
│  │ 담당: 채널 3개 │  │ 담당: 이메일   │  │ 담당: 일정     │
│  └──────┬───────┘  └──────┬───────┘  └──────┬────────┘
│         │                │                 │
│         ▼                ▼                 ▼
│      결과 전달         결과 전달          결과 전달
│                                                   │
│  ──▶ 결과 모아서 통합 문서 작성                     │
└───────────────────────────────────────────────────┘
```

각 subagent는 독립된 실행 환경에서 작동하며, 메인 Claude는 모든 subagent의 결과를 취합합니다.

</details>

### Block 0에서 만든 스킬과의 연결

Block 0에서 생성한 스킬의 "실행 흐름 → 1단계: 병렬 수집" 섹션이 바로 이 구조입니다.
스킬 파일에 이미 아래와 같은 내용이 적혀 있습니다:

```
수집 시작
  ├── [소스 1] Slack 채널 메시지 수집      ─┐
  ├── [소스 2] Gmail 이메일 수집            ├── 병렬 실행
  ├── [소스 3] Google Calendar 일정 수집    │
  └── [소스 4] Notion 태스크 수집           ─┘
수집 완료
```

이번 블록에서는 이 병렬 수집을 **실제로 실행**해봅니다.

## EXECUTE

### 실행 안내

Claude에게 아래와 같이 요청하여 Block 0에서 생성한 스킬의 병렬 수집을 실행합니다:

```
내 context sync 스킬의 병렬 수집을 실행해줘
```

Claude가 하는 일:

1. 사용자의 `.claude/skills/my-context-sync/SKILL.md`를 읽어서 소스 목록을 확인합니다
2. 각 소스별로 subagent(Task 도구)를 **동시에** 호출합니다
3. 사용자의 화면에는 각 subagent의 진행 상황이 표시됩니다:
   ```
   [Slack 수집] 진행 중...
   [Gmail 수집] 진행 중...
   [Calendar 수집] 진행 중...
   ```
4. 수집이 완료되면 소스별로 결과를 정리하여 보여줍니다

### 수집 결과 리포트

수집이 끝나면 **성공한 소스**와 **실패한 소스**를 구분하여 보여줍니다:

```
수집 결과:
  Slack: 3개 채널, 47개 메시지 (성공 ✅)
  Gmail: 12개 이메일 (성공 ✅)
  Calendar: 수집 실패 ❌ (원인: 인증 토큰 만료)
  Notion: 15개 태스크 (성공 ✅)

성공: 3/4 소스
실패: 1/4 소스 (다음 블록에서 재시도합니다)
```

> 실패한 소스가 있어도 괜찮습니다! 아래 결과 검증 단계에서 실패 원인을 분석하고 재시도합니다.

### 수집된 데이터 미리보기

각 소스별로 수집된 내용의 요약을 확인합니다:

```
[Slack 요약]
  - #general: 주간 회의 시간 변경 공지
  - #project-updates: v2.0 배포일 확정
  - 총 47개 메시지 중 중요 5개 추출

[Gmail 요약]
  - 안 읽은 이메일 5개
  - 회신 필요: 2개
  - 총 12개 이메일 중 액션 필요 3개
```

이 결과가 아래 결과 검증 단계와 Block 4(출력 포맷)에서 활용됩니다.

## 결과 검증

### 실패 원인 분류

수집이 실패하는 이유는 크게 4가지입니다:

| 원인 | 설명 | 해결 방법 |
|------|------|----------|
| **인증 문제** | API 키가 만료되었거나 잘못된 경우 | 키 재발급 또는 재입력 |
| **네트워크 문제** | 인터넷 연결 불안정, 서버 점검 중 | 잠시 후 재시도 |
| **권한 문제** | 해당 채널/폴더에 접근 권한이 없는 경우 | 권한 요청 또는 대상 변경 |
| **도구 설정 문제** | MCP 서버가 꺼져 있거나 설정이 잘못된 경우 | `/mcp` 명령으로 상태 확인 후 재설정 |

> 가장 흔한 원인은 **인증/API 키 문제**입니다.

### 데이터 품질 체크

수집에 성공했다고 끝이 아닙니다. 가져온 정보가 **실제로 유용한지** 확인해야 합니다.

| 문제 | 증상 | 대응 |
|------|------|------|
| **빈 결과** | 수집은 성공했지만 데이터가 0건 | 수집 범위(날짜, 채널 등)를 넓히기 |
| **오래된 데이터** | 한 달 전 메시지가 포함됨 | 날짜 필터를 최근 7일로 조정 |
| **중복 데이터** | 같은 메시지가 여러 번 나옴 | 중복 제거 로직 추가 |
| **너무 많은 데이터** | 수백 개의 메시지가 한꺼번에 | 필터링 기준(키워드, 중요도) 추가 |

실패한 소스가 있으면 Claude에게 재시도를 요청하고, 데이터 품질이 맞지 않으면 스킬의 "추출할 정보" 섹션을 조정합니다.

## QUIZ

```json
AskUserQuestion({
  "questions": [
    {
      "question": "\"병렬 수집\"의 가장 큰 장점은 무엇인가요?",
      "header": "Quiz 3-1",
      "options": [
        {"label": "여러 소스를 동시에 수집하여 시간을 절약한다", "description": "각 subagent가 독립적으로 동시 실행"},
        {"label": "데이터를 더 정확하게 수집한다", "description": "정확도는 병렬/순차와 무관"},
        {"label": "하나가 실패하면 전체가 멈춘다", "description": "오히려 독립 실행이라 다른 소스에 영향 없음"}
      ],
      "multiSelect": false
    },
    {
      "question": "수집이 실패한 소스는 어떻게 처리하나요?",
      "header": "Quiz 3-2",
      "options": [
        {"label": "실패 원인과 함께 리포트하고, 다음 단계에서 재시도한다", "description": "Block 4에서 실패 원인 분석 + 재시도"},
        {"label": "무시하고 넘어간다", "description": "실패한 소스도 중요한 정보일 수 있음"},
        {"label": "전체 수집을 처음부터 다시 한다", "description": "성공한 소스까지 다시 할 필요 없음"}
      ],
      "multiSelect": false
    }
  ]
})
```

정답: 3-1은 1번, 3-2는 1번.

### Quiz 3-3 (결과 검증)

```json
AskUserQuestion({
  "questions": [
    {
      "question": "수집이 실패하는 가장 흔한 원인은 무엇인가요?",
      "header": "Quiz 3-3",
      "options": [
        {"label": "인증/API 키 문제", "description": "키 만료, 오타, 권한 부족 등이 가장 흔함"},
        {"label": "인터넷 연결 문제", "description": "가끔 발생하지만 가장 흔하지는 않음"},
        {"label": "Claude의 버그", "description": "Claude 자체 문제보다는 외부 서비스 연결 문제가 대부분"}
      ],
      "multiSelect": false
    }
  ]
})
```

정답: 3-3은 1번.
